{
  "hash": "25824c620a99ebadfe5426b199296028",
  "result": {
    "markdown": "---\ntitle: \"Area plot with Nile\"\nauthor: \"Junho (Sean) Ahn\"\ndate: \"2023-08-26\"\ncategories: [ggplot, visualization]\nimage: \"image.png\"\n---\n\n\n## Initializing\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngraphics.off()\nrm(list = ls())\ngc()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n          used (Mb) gc trigger (Mb) limit (Mb) max used (Mb)\nNcells  575928 30.8    1310808 70.1         NA   669400 35.8\nVcells 1051059  8.1    8388608 64.0      16384  1851626 14.2\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nversion\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n               _                           \nplatform       aarch64-apple-darwin20      \narch           aarch64                     \nos             darwin20                    \nsystem         aarch64, darwin20           \nstatus                                     \nmajor          4                           \nminor          3.1                         \nyear           2023                        \nmonth          06                          \nday            16                          \nsvn rev        84548                       \nlanguage       R                           \nversion.string R version 4.3.1 (2023-06-16)\nnickname       Beagle Scouts               \n```\n:::\n:::\n\n\n## Loading Useful Library\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.2     ✔ readr     2.1.4\n✔ forcats   1.0.0     ✔ stringr   1.5.0\n✔ ggplot2   3.4.2     ✔ tibble    3.2.1\n✔ lubridate 1.9.2     ✔ tidyr     1.3.0\n✔ purrr     1.0.1     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n:::\n\n```{.r .cell-code}\nlibrary(tsibble)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'tsibble'\n\nThe following object is masked from 'package:lubridate':\n\n    interval\n\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, union\n```\n:::\n\n```{.r .cell-code}\nlibrary(gghighlight)\n```\n:::\n\n\n## Select Dataset\n\n**Flow of the River Nile**\n\n### Description\n\nMeasurements of the annual flow of the river Nile at Aswan (formerly Assuan), 1871–1970, in 10^8 m^3, “with apparent changepoint near 1898” (Cobb(1978), Table 1, p.249).\n\n### Usage\n\nNile\n\n### Format\n\nA time series of length 100.\n\n### Source\n\nDurbin, J. and Koopman, S. J. (2001). Time Series Analysis by State Space Methods. Oxford University Press. http://www.ssfpack.com/DKbook.html\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nNile\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nTime Series:\nStart = 1871 \nEnd = 1970 \nFrequency = 1 \n  [1] 1120 1160  963 1210 1160 1160  813 1230 1370 1140  995  935 1110  994 1020\n [16]  960 1180  799  958 1140 1100 1210 1150 1250 1260 1220 1030 1100  774  840\n [31]  874  694  940  833  701  916  692 1020 1050  969  831  726  456  824  702\n [46] 1120 1100  832  764  821  768  845  864  862  698  845  744  796 1040  759\n [61]  781  865  845  944  984  897  822 1010  771  676  649  846  812  742  801\n [76] 1040  860  874  848  890  744  749  838 1050  918  986  797  923  975  815\n [91] 1020  906  901 1170  912  746  919  718  714  740\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nclass(Nile)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"ts\"\n```\n:::\n:::\n\n\n\nThe tsibble package provides a data infrastructure for tidy temporal data with wrangling tools. Adapting the tidy data principles, tsibble is a data- and model-oriented object. In tsibble:\n\n1. Index is a variable with inherent ordering from past to present.\n\n2. Key is a set of variables that define observational units over time.\n\n3. Each observation should be uniquely identified by index and key.\n\n4. Each observational unit should be measured at a common interval, if regularly spaced.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#coerce ts to tsibble\ndf <- as_tsibble(Nile)\ndf |> head()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tsibble: 6 x 2 [1Y]\n  index value\n  <dbl> <dbl>\n1  1871  1120\n2  1872  1160\n3  1873   963\n4  1874  1210\n5  1875  1160\n6  1876  1160\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nclass(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"tbl_ts\"     \"tbl_df\"     \"tbl\"        \"data.frame\"\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndim(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 100   2\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncolnames(df) <- c(\"year\", \"flow\")\ndf |> head()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tsibble: 6 x 2 [1Y]\n   year  flow\n  <dbl> <dbl>\n1  1871  1120\n2  1872  1160\n3  1873   963\n4  1874  1210\n5  1875  1160\n6  1876  1160\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf |> \n  ggplot(aes(year, flow)) +\n  geom_line()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf1 <- \n  df |> \n  mutate(grp = cut_number(year, 2, labels = FALSE), \n         lag = difference(flow, default = 0))\ndf1\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tsibble: 100 x 4 [1Y]\n    year  flow   grp   lag\n   <dbl> <dbl> <int> <dbl>\n 1  1871  1120     1     0\n 2  1872  1160     1    40\n 3  1873   963     1  -197\n 4  1874  1210     1   247\n 5  1875  1160     1   -50\n 6  1876  1160     1     0\n 7  1877   813     1  -347\n 8  1878  1230     1   417\n 9  1879  1370     1   140\n10  1880  1140     1  -230\n# ℹ 90 more rows\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf1 |> \n  ggplot(aes(year)) +\n  geom_area(aes(y = flow), fill = \"midnightblue\") +\n  geom_area(aes(y = lag), fill = \"orange\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf1 |> \n  ggplot(aes(year)) +\n  geom_area(aes(y = flow), fill = \"midnightblue\") +\n  geom_area(aes(y = lag), fill = \"orange\") +\n  facet_wrap(vars(grp), ncol = 1)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngrp_status <- c( \"1\" = \"First 50years\", \"2\" = \"Second 50years\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf1 |> \n  ggplot(aes(year)) +\n  geom_area(aes(y = flow), fill = \"midnightblue\") +\n  geom_area(aes(y = lag), fill = \"orange\") +\n  facet_wrap(vars(grp), ncol = 1, scale = \"free_x\", labeller = labeller(grp = grp_status))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf1 |> \n  ggplot(aes(year)) +\n  geom_area(aes(y = flow, fill = \"Flow\")) +\n  geom_area(aes(y = lag, fill = \"Lag\")) +\n  facet_wrap(vars(grp), ncol = 1, scale = \"free_x\", labeller = labeller(grp = grp_status)) +\n  scale_fill_manual(name = \"Legend\", values = c(\"Flow\" = \"midnightblue\", \"Lag\" = \"orange\"))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n\nThe first 50 years of the 100-year period saw more change, while the second 50 years saw less change.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf1 |> \n  ggplot(aes(year)) +\n  geom_area(aes(y = flow, fill = \"Flow\")) +\n  geom_area(aes(y = lag, fill = \"Lag\")) +\n  facet_wrap(vars(grp), ncol = 1, scale = \"free_x\", labeller = labeller(grp = grp_status)) +\n  scale_fill_manual(name = \"Legend\", values = c(\"Flow\" = \"midnightblue\", \"Lag\" = \"orange\")) +\n  labs(title = \"Flow of the River Nile\", \n       subtitle = paste0(\"Measurements of the annual flow of the river Nile at Aswan (formerly Assuan), 1871–1970,\",\"\\n\" ,\"in 10^8 m^3\"),\n       x = \"Year\", y = \"Flow (10^8 cu.m)\") +\n  theme_bw() + theme(legend.position = \"bottom\", \n                     legend.box.background = element_rect(colour = \"black\"))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\n\n\n<div class=\"right\">\n__END OF POST__\n</div>",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}